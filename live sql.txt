/*
COUNTRIES	Table
DEPARTMENTS	Table	
EMPLOYEES	Table	
EMP_DETAILS_VIEW	View	
JOBS	Table	
JOB_HISTORY	Table	
LOCATIONS	Table
REGIONS	Table	
*/
-- 나라별 ID, 지역번호 : COUNTRY_ID	COUNTRY_NAME	REGION_ID
SELECT * FROM COUNTRIES;

-- 부서 : DEPARTMENT_ID	DEPARTMENT_NAME	MANAGER_ID	LOCATION_ID
SELECT * FROM DEPARTMENTS;

-- 회원 : EMPLOYEE_ID	FIRST_NAME	LAST_NAME	EMAIL	PHONE_NUMBER	HIRE_DATE	JOB_ID	SALARY	COMMISSION_PCT	MANAGER_ID	DEPARTMENT_ID
SELECT * FROM EMPLOYEES;

-- 회원 상세정보 : EMPLOYEE_ID	JOB_ID	MANAGER_ID	DEPARTMENT_ID	LOCATION_ID	COUNTRY_ID	FIRST_NAME	LAST_NAME	SALARY	COMMISSION_PCT	DEPARTMENT_NAME	JOB_TITLE	CITY	STATE_PROVINCE	COUNTRY_NAME	REGION_NAME
SELECT * FROM EMP_DETAILS_VIEW;

-- 직업 분류 : JOB_ID	JOB_TITLE	MIN_SALARY	MAX_SALARY
SELECT * FROM JOBS;

-- 직업 히스토리 : EMPLOYEE_ID	START_DATE	END_DATE	JOB_ID	DEPARTMEN00T_ID
SELECT * FROM JOB_HISTORY;

-- 위치 : LOCATION_ID	STREET_ADDRESS	POSTAL_CODE	CITY	STATE_PROVINCE	COUNTRY_ID
SELECT * FROM LOCATIONS;

-- 지역 : REGION_ID	REGION_NAME
SELECT * FROM REGIONS;





CREATE OR REPLACE PROCEDURE RUN_PROC
IS
    RETURN_MESSAGE VARCHAR2(100) := 'HELLO ORACLE SQL';
    RETURN_MESSAGE2 VARCHAR2(100) := 'HA HA HA HA HA';
BEGIN
    DBMS_OUTPUT.PUT_LINE(RETURN_MESSAGE);
    DBMS_OUTPUT.PUT_LINE(RETURN_MESSAGE2);
END RUN_PROC;

EXEC RUN_PROC;


MERGE INTO COUNTRIES C
USING DUAL
ON (C.COUNTRY_ID = 'KR')
    WHEN MATCHED THEN 
        UPDATE SET C.COUNTRY_NAME = 'Republic of korea' WHERE C.COUNTRY_ID = 'KR'
    WHEN NOT MATCHED THEN
        INSERT (C.COUNTRY_ID, C.COUNTRY_NAME, C.REGION_ID)
        VALUES('KR', 'Republic of korea', 3);



-- 직업 별 연봉 평균 값 
SELECT A.JOB_TITLE 직업이름, COUNT(*) 직원수, ROUND(AVG(E.SALARY + DECODE(E.COMMISSION_PCT, NULL, 0, 0, 0, (E.SALARY * COMMISSION_PCT))), 1) 평균연봉
  FROM JOBS A, EMPLOYEES E
 WHERE A.JOB_ID = E.JOB_ID
GROUP BY A.JOB_TITLE
ORDER BY ROUND(AVG(E.SALARY + DECODE(E.COMMISSION_PCT, NULL, 0, 0, 0, (E.SALARY * COMMISSION_PCT))), 1) DESC;


SELECT C.COUNTRY_NAME 나라, CITY 도시, L.STREET_ADDRESS 주소, (E.FIRST_NAME || ' ' || E.LAST_NAME) 이름, NVL((E.SALARY * 12), 0) 연봉,  D.DEPARTMENT_NAME
  FROM COUNTRIES C, LOCATIONS L, DEPARTMENTS D, EMPLOYEES E
 WHERE C.COUNTRY_ID = L.COUNTRY_ID
   AND L.LOCATION_ID = D.LOCATION_ID
   AND D.DEPARTMENT_ID = E.DEPARTMENT_ID
   AND NVL((E.SALARY * 12), 0) > (
                                    SELECT MAX(NVL((E.SALARY * 12), 0))
                                      FROM EMPLOYEES E, DEPARTMENTS D
                                     WHERE E.DEPARTMENT_ID = D.DEPARTMENT_ID
                                       AND D.DEPARTMENT_NAME = 'Shipping'
                                 );



-- 직원의 풀네임, 부서이름, 도시 이름, 국가명 조회
SELECT (E.FIRST_NAME || ' ' || E.LAST_NAME) 풀네임, D.DEPARTMENT_NAME 부서이름, L.CITY 도시이름, C.COUNTRY_NAME 국가명
  FROM EMPLOYEES E, DEPARTMENTS D, LOCATIONS L, COUNTRIES C
 WHERE E.DEPARTMENT_ID = D.DEPARTMENT_ID
   AND E.MANAGER_ID = D.MANAGER_ID
   AND D.LOCATION_ID = L.LOCATION_ID
   AND L.COUNTRY_ID = C.COUNTRY_ID;











